var cityArr=["shanghai","beijing","suzhou","wuxi","dalian","shenyang","wuhan"];var categoryArr=["gongren","siji","baoan"];function $(a){return document.getElementById(a);}function $t(b,a){return $(b).getElementsByTagName(a);}function stringTrim(a){return a.replace(/(^\s*)|(\s*$)/g,"");}Array.prototype.inArray=function(b){for(var a=0;a<this.length;a++){if(this[a]===b){return true;}}return false;};function readCookie(a){var c="";var b=a+"=";if(document.cookie.length>0){offset=document.cookie.indexOf(b);if(offset!=-1){offset+=b.length;end=document.cookie.indexOf(";",offset);if(end==-1){end=document.cookie.length;}c=decodeURIComponent(document.cookie.substring(offset,end));}}return c;}var errorCount=0;var promotedContact=false;var promotedMobile=true;var googlePostFormSubmit=true;var alertedMissingContacts=false;FV=function(){};FV.prototype={inputClick:function(a){if(!$(a.name+this.keyName)){return;}if(a.tips==undefined){a.tips=$(a.name+this.keyName).innerHTML;}var b=$(a.name+this.keyName);b.className="check";b.innerHTML=a.tips;$("validateTag").innerHTML=("");},inputBlur:function(b){var a=this;a.valids(b);},setEvent:function(){this.keyName="Check";var val=function(){eval(ax).inputBlur(this);};var set=function(){eval(ax).inputClick(this);};var ax=this.method;this.form=$(this.formId);for(var i=0;i<this.form.elements.length;i++){var fei=this.form.elements[i];if(fei.type!="hidden"){fei.onblur=val;fei.onfocus=set;if($(fei.name+this.keyName)){if(fei.tips==undefined){fei.tips=$(fei.name+this.keyName).innerHTML;}}}}this.form.onsubmit=function(){var ps=$("postSubmit");var vt=$("validateTag");ps.disabled=true;if(googlePostFormSubmit&&!isBianji){postTrackEvent("点了发布按钮","发贴表单");googlePostFormSubmit=false;}postTrackEvent("点了发布按钮发布或编辑",isBianji?"编辑表单":"发贴表单");var f=eval(ax);f.setEvent();f.validate=true;for(var n=0;n<f.form.elements.length;n++){f.valids(f.form.elements[n]);}if(f.validate){var hasContact=document.getElementById("description").value.match(/\d{7,}/);if(!hasContact&&!promotedContact){promotedContact=true;postTrackEvent("error-缺少联系方式","发贴表单");if(!alertedMissingContacts){alertedMissingContacts=true;alert("您好像忘记留下联系方式了，请重新检查一遍。");ps.disabled=false;document.getElementById("description").focus();return false;}}var hasMobile=document.getElementById("description").value.match(/\d{11,}/);if(!hasMobile&&!promotedMobile&&location.search.match(/game1/)){promotedMobile=true;postTrackEvent("error-缺少手机号lv活动","发贴表单");alert("您好像忘记留下手机号了，请重新检查一遍，否则无法将验证码发送到您的手机上。");ps.disabled=false;document.getElementById("description").focus();return false;}vt.innerHTML=f.returnError("postError",1);if(!isBianji){try{if($("imgHint").value!=0){postTrackEvent("图片没传完就点发布","发贴表单");}var lc=new Date().getTime()-plstart.getTime();if(lc>0){_gaq.push(["_trackEvent","PostFlow","发贴表单","停留时间",Math.min(lc,300000)]);}}catch(e){}}postTrackEvent("点发布按钮无错出错次数"+errorCount,isBianji?"编辑表单":"发贴表单");return true;}else{ps.disabled=false;vt.innerHTML=f.returnError("postError",0);try{errorCount++;postTrackEvent("第"+errorCount+"次表单出错",isBianji?"编辑表单":"发贴表单");trackFormError();}catch(e){}return false;}};},valids:function(v){var classNames=v.className.split(" ");if(classNames.inArray("field")){if(classNames.inArray("required")){if(v.type=="checkbox"){var e=requiredCheckboxValid(this.form,v);}else{if(v.type=="radio"){var e=requiredRadioValid(this.form,v);}else{var e=(requiredValid(v.value));}}if(e!=null){return this.showError(v,this.returnError(v.name,e));}}try{if(typeof(eval(v.name+"Valid"))=="function"){var e=eval(v.name+"Valid")(v.value);if(e!=null){return this.showError(v,this.returnError(v.name,e));}}}catch(x){}}if(v.id=="description"){if(v.value.length>5000){return this.showError(v,this.returnError("description",1));}}},showError:function(a,c){if(!$(a.name+this.keyName)){return;}var b=$(a.name+this.keyName);if(!a.tips){b.innerHTML;}b.innerHTML=c;b.className="errMsg";this.validate=false;},returnError:function(c,a){var b=new Array();b.required=new Array("此项不能为空或必选！");b.title=new Array("标题不能不写！","标题字数要小于25个字！");b.description=new Array("","你的信息太长了，请修改，最多允许 5000个汉字 ");b.category=new Array("必须选择一个大类目和一个小类目！");b.areaId=new Array("必须选择所在地！");b.gongqiu=new Array("供求必须选一项！");b.password=new Array("密码必须设置一个，并牢记！");b.SponsorCategories=new Array("必须选择一个你要投放的详细类目！");b.passwordb=new Array("再次输入的密码与设置的密码必须相同！");b.postError=new Array('<div class="errMsg">上边某项填写有错，请更改后重新发布！出错的提示是红色的！</div>','<div class="load">表单正在提交中，请稍候！：）</div>');if(b[c]){return b[c][a];}else{if(!a.toString().match(/\d+/)){return a;}else{return b.required[0];}}}};function requiredValid(a){if(stringTrim(a)==""){return 0;}return null;}function requiredCheckboxValid(e,b){var a=e.elements;var f=new Array();for(var d=0;d<a.length;d++){if(a[d].type=="checkbox"&&a[d].name==b.name){f[f.length]=a[d];}}var c=0;for(var d=0;d<f.length;d++){if(f[d].checked){c++;break;}}if(c==0){return 0;}return null;}function requiredRadioValid(e,b){var a=e.elements;var f=new Array();for(var d=0;d<a.length;d++){if(a[d].type=="radio"&&a[d].name==b.name){f[f.length]=a[d];}}var c=0;for(var d=0;d<f.length;d++){if(f[d].checked){c++;break;}}if(c==0){return 0;}return null;}function titleValid(a){var b=stringTrim(a);if(b==""){return 0;}else{if(b.length>25){return 1;}}return null;}function descriptionValid(b){var c=stringTrim(b);var a=0;for(i=0;i<c.length;i++){a+=c.charCodeAt(i)<0||c.charCodeAt(i)>255?3:1;}if(a>10000){return 1;}return null;}function passwordbValid(a){if(!$("password")){return null;}if(!$("passwordb")){return null;}if($("passwordb").value!=$("password").value){return 0;}return null;}function setLiImg(b){var a=document.createElement("li");a.setAttribute("id","li_"+b);a.innerHTML=('<img src="http://static.baixing.net/images/css/global/img_loader.gif" class="imgUpload" width="64" height="64" />');$("imagesUl").appendChild(a);jQuery("#imagesTable").show();return;}function deleteImgNumber(){var a=$("imgHint");a.value=parseInt(a.value)-1;return;}function RemovePreview(a){$("imagesUl").removeChild(a.parentNode.parentNode.id=="imagesUl"?a.parentNode:a.parentNode.parentNode);postTrackEvent("删除了一张照片",isBianji?"编辑表单":"发贴表单");uploader.refresh();}function setLiImgError(d,b,c){var a=c;$("li_"+d).innerHTML=('<div class="imgUpError">'+a+'</div><a href="javascript:void(0)" onclick="RemovePreview(this)">取消</a>');deleteImgNumber();postTrackEvent("uploadImgError-"+b,"error");}function insertImg(d,c){var b=c.replace(/\.(\w+)$/,"_sq.$1");var a=('<input type="hidden" name="image[]" value="'+c+'" /><img src="'+b+'" width="64" height="64" class="imgBorderBeta" /><span class="imgBeta"> <img width="10" height="8" src="http://static.baixing.net/images/post/dui.gif" align="absmiddle" /> 上传成功 <a href="javascript:void(0)" onclick="RemovePreview(this)"><img src="http://static.baixing.net/images/post/laji.gif" align="absmiddle" width="10" height="10" alt="删除这张图片" border="0" /></a></span><div class="blank10"></div>');$("iframes").removeChild($(d).parentNode);if(!$("li_"+d)){return;}$("li_"+d).innerHTML=a;deleteImgNumber();postTrackEvent("上传了一张照片",isBianji?"编辑表单":"发贴表单");jQuery("#imagesTable").show();}function addIframe(b){var a=('<iframe name="'+b+'" id="'+b+'"></iframe>');var d=document.createElement("div");d.style.display="none";d.innerHTML=a;$("iframes").appendChild(d);var c=$("imgHint");c.value=parseInt(c.value)+1;return;}function secondCategoryHtml(a){var d="";for(var c=0;c<categoryBoxArray.length;c++){if(categoryBoxArray[c]["englishName"]==a){var e=categoryBoxArray[c]["children"];d+="<div>";d+="<table>";d+="<tr>";var b=0;for(var f=0;f<e.length;f++){if(b%9==0){d+="<td>";}b++;d+='<a onclick="return clickSecondCategory(this);" hidefocus="true" title="'+e[f]["englishName"]+'" ';d+=' href="/fabu/'+cityEnglishName+"/"+getQueryString()+"&category="+e[f]["englishName"]+'">'+e[f]["name"]+"</a>";if(b%9==0){d+="</td>";}}d+="</tr>";d+="</table>";d+="</div>";}}return d;}function getQueryString(){qStr="?";if(getParam("src")){qStr+="&src="+getParam("src");}if(getParam("v")){qStr+="&v="+getParam("v");}return qStr;}function getParam(a){var b=location.search.match(new RegExp("[?&]"+a+"=([^&]*)(&?)","i"));return b?b[1]:b;}function clickFirstCategory(c){firstCategoryEname=c.title;firstCategoryName=c.innerHTML;$("secondCategory").innerHTML=secondCategoryHtml(firstCategoryEname);$("secondCategory").style.display="block";$("jiantou").style.display="block";$("category").value="";$("categoryCheck").innerHTML="";$("categoryCheck").className="check";var b=$("firstCategory");var a=b.getElementsByTagName("a");for(var d=0;d<a.length;d++){a[d].className="n";if(a[d]==c){a[d].className="on";}}$("seCategory").style.display="none";$("setAttribute").innerHTML="";$("setAttribute").style.display="none";$("gongqiu").innerHTML="";$("validateTag").innerHTML=("");return false;}function getCategoryLimitTip(b,a){var c="本类目一天可以发布3条信息。";if(b=="fuwu"){c="生活服务类目一天可以发布1条信息。";}if(b=="fang"){c="";}if(a=="nvzhaonan"){c="女找男类目一天可以发布1条信息。";}if(a=="nanzhaonv"){c="男找女类目一天可以发布1条信息。";}if(a=="zhenghun"){c="征婚类目一天可以发布1条信息。";}if(a=="chongwulingyang"){c="宠物免费赠送类目一周可以发布1条信息。";}return'<small style="color:#009900">'+c+"</small>";}function clickSecondCategory(b){var f=b.title;if(f=="nianhuijiangpin"){alert("年会奖品请发布到“物品交易”的对应类目!");jQuery("a[title=ershou]").click();return false;}$("category").value=f;$("categoryCheck").innerHTML="";$("postNav").innerHTML="<span>"+firstCategoryName+" &raquo; "+b.innerHTML+"</span>";$("postNav").innerHTML+=' <small><a href="'+rootCategoryLink+'" onclick="return changeCategory()">重选类目</a></small>&nbsp;'+getCategoryLimitTip(firstCategoryEname,f);var e=$("secondCategory");var c=e.getElementsByTagName("a");for(var d=0;d<c.length;d++){c[d].className="n";if(c[d]==b){c[d].className="on";}}$("categoryItem").style.display="none";$("seCategory").style.display="block";showAttribute();$("imageHint").style.display=(b.title=="ershouqiche")?"block":"none";$("validateTag").innerHTML=("");var a=new Image();a.src="/images/jiantou.gif?id="+Math.floor(Math.random()*10000);trackControlsCount(f+"0");return false;}function clickNewGongQiu(a){jQuery("#setAttribute").html(a=="1"?wantedMetaHtml:metaHtml);trackControlsCount($("category").value+(a=="1"?1:0));refreshDescriptionTips();}function refreshDescriptionTips(){if(!descriptionTips){return;}if(jQuery('input:radio[name="wanted"]').length==0){jQuery("#descriptionCheck ~ .tipMsg").text(descriptionTips);}else{if(jQuery('input:radio:checked[name="wanted"]').length>0&&jQuery('input:radio:checked[name="wanted"]').val()=="0"){jQuery("#descriptionCheck ~ .tipMsg").text(descriptionTips);}else{jQuery("#descriptionCheck ~ .tipMsg").text("");}}}var dbsize="";function showAttribute(){if(dbsize==""){dbsize=$("double_size").value;}var b=$("setAttribute");var a=$("category").value;b.innerHTML='<img src="http://static.baixing.net/images/bar.gif" />';b.style.display="block";if(jQuery.inArray(cityEnglishName,cityArr)!=-1&&jQuery.inArray($("category").value,categoryArr)!=-1&&jQuery("input[name=wanted]")){jQuery("#licenceRequireTip").show();if(dbsize!=1){jQuery("#double_size").val("1");}}else{jQuery("#licenceRequireTip").hide();if(dbsize!=1){jQuery("#double_size").val("0");}}if(jQuery("#jobItem")){jQuery("#jobItem").remove();}jQuery.getJSON("?action=metaHtml&category="+a+(isBianji?"&adId="+adId+"&r="+Math.floor(Math.random()*100000):""),function(c){metaHtml=c.att;wantedMetaHtml=c.wantedAtt;jQuery("#gongqiu").html(c.gq).css("display","block");jQuery("#setAttribute").html(jQuery("input:radio[name=wanted]:checked").val()=="1"?wantedMetaHtml:metaHtml).css("display","block");descriptionTips=c.descriptionTips;refreshDescriptionTips();});return false;}function changeCategory(){$("categoryItem").style.display="block";$("seCategory").style.display="none";try{if(!isBianji){postTrackEvent("点-重选类目-"+src,"发贴表单");}else{postTrackEvent("点-重选类目","编辑表单");}}catch(a){}return false;}function labelOnclick(c){if(window.XMLHttpRequest){return;}var a=c.getElementsByTagName("input")[0];a.focus();a.click();a.checked=true;return;}function trackFormError(){var b="";var c=$t("postForm","div");for(var a=0;a<c.length;a++){if(stringTrim(c[a].className)=="errMsg"){b=b+c[a].id+" | ";}}postTrackEvent("error-"+b,isBianji?"编辑表单":"发贴表单");}function postTrackEvent(b,a){try{_gaq.push(["_trackEvent","PostFlow",a,b,1]);return true;}catch(c){return false;}}var AreaSelect={firstSelected:function(){var b=$("areaId");var f=$("areaSecondLevelId");if(!f){return;}var a=this.arrayIndex(areasArr,b.value);if(a<0){f.options.length=1;return;}var d=secondAreasArr[a];f.options.length=1;for(var c=0;c<d.length;c++){var e=d[c];f.options[f.options.length]=new Option(e[0],e[1]);}},arrayIndex:function(a,c){for(var b=0;b<a.length;b++){if(a[b][1]==c){return b;}}return -1;},select:function(c,b){var d=c.options;for(var a=0;a<d.length;a++){$o[a].selected=d[a].value==b;}}};function trackControlsCount(a){_gaq.push(["_trackEvent","PostFlow","controlNum",a,jQuery("#postTable td.name:visible:parent").length]);}function toggleHidden(){jQuery("#setAttribute div[class*=toggleField]").toggleClass("on off");return false;}